!function(){"use strict";function t(t,e){this.url=t,this.update_cb=e,this.state={},this.probeStart(!0),this.probeDo()}t.prototype.probeStart=function(t){if(t==this.state.poll){if(this.state.probeTimer)return}else this.probeStop();this.state.poll=t;var e=t?3:10,r=setInterval(this.probeDo.bind(this,!1),1e3*e);this.state.probeTimer=r},t.prototype.probeStop=function(){this.state.probeTimer&&(clearInterval(this.state.probeTimer),delete this.state.probeTimer,this.state.probe&&this.state.probe.abort())},t.prototype.probeDo=function(t){this.state.probe&&(this.update_cb(!1,"Timeout connecting to remote, retrying..."),this.state.probe.abort());var e=new XMLHttpRequest;this.state.probe=e;var r=this,o=this.url;t&&(o+="?force"),e.open("GET",o,!0),e.onload=function(t){switch(delete r.state.probe,t.target.status){case 204:r.probeStart(!0),r.update_cb(!1,"Remote AP scan in progress...");break;case 200:r.probeStart(!1),r.update_cb(!0,t.target.responseText);break;default:r.probeStart(!1),r.update_cb(!1,"Unrecognized status ("+t.target.status+")")}},e.onerror=function(t){delete r.state.probe,r.state.probeTimer&&r.probeStart(!1),r.update_cb(!1,"Error - "+(t.error||"Unable to connect to remote"))},e.onabort=function(t){delete r.state.probe,r.state.probeTimer&&r.probeStart(!1),r.update_cb(!1,"Connection to remote aborted")},e.send()},t.prototype.probeRefresh=function(){this.probeDo(!0)},window.APScan=t}();